

{% macro render_entries() %}
    {% set ns = namespace(prev_date = '') %}
    {% for e in entries %}
        {% set date = e.published_on|since_today %}
        {% if date != ns.prev_date %}
            <li class="heading">
                <h2><time>{{date}}</time></h2>
            </li>            
        {% endif %}
        <li class="entry {% if e.id in saved_ids %}status-saved{% endif %} {%if e.id in read_ids %}status-read{% else %}status-unread{% endif %}">
            <div class="entry-card">
                <input onchange="Sweat.loadEntry('{{e.id}}', event)" id="c-{{e.id}}" type="radio" value="{{e.id}}" name="entries">
                <label for="c-{{e.id}}">
                    <div class="entry-card__status">
                        <i class="fa fa-circle"></i>
                    </div>
                    <div>
                        <h4 class="feed">
                            <!-- <img class="favicon" src="{{e.feed.icon_url}}" width="16" height="16"  alt="*"> -->
                            {{e.feed.title}}
                        </h4>
                        <h3 class="entry-card__title">
                            {{e.title}}
                        </h3>
                    </div>
                </label>
                <!-- 
                <div class="meta dim">
                    <span class="actions">
                        {% if e.id in saved_ids %}<i class="save-trigger icon-saved fa" title="Unsave"></i>{% else %}<i class="save-trigger icon-unsaved fa" title="Save"></i>{%endif%}{% if e.id in read_ids %}<i class="read-trigger icon-read fa" title="Make as unread"></i>{%else%}<i class="read-trigger icon-unread fa" title="Mark as read"></i>{%endif%}                    
                    </span>
                </div>
                -->
            </div>
            <template id="template-{{e.id}}">             
                <div class="view2">                      
                    <div class="entry expanded {%if e.id in saved_ids%}status-saved{% endif %} {%if e.id in read_ids %}status-read{% endif %}">
                        <div class="item-inner">
                            <article>
                                <div class="meta dim">
                                    <span class="feed"><a title="Show more entries for this feed" href="{{ url_for('main.entry_list', feed=e.feed.id, filter=filter_name) }}">{{e.feed.title}}</a></span>
                                    <span class="actions">
                                        {%if e.id in saved_ids%}<i class="save-trigger icon-saved fa fa-star" title="Unsave (S key)"></i>{% else %}<i class="save-trigger icon-unsaved fa fa-star-o" title="Save (S key)"></i>{% endif %}{%if e.id in read_ids %}<i class="read-trigger icon-read fa fa-circle-o" title="Mark as unread (M key)"></i>{% else %}<i class="read-trigger icon-unread fa fa-circle" title="Mark as read (M key)"></i>{% endif %}                    
                                    </span>
                                </div>
                                <h1 class="article__title">{{e.title}}</h1>        
                                {%if e.content %} 
                                    <div class="article__content">
                                        {{e.content|safe}}
                                        {%if e.link %}
                                            <div class="continue"><a class="btn btn-small btn-visit" rel="noreferrer" title="View entry on {{e.link}} (V key)" target="_blank" href="{{e.link}}"><i class="fa fa-globe"></i> Visit Website</a></div>
                                        {% endif %}
                                    </div>            
                                    <hr class="halved">
                                {% endif %}
                                <div class="meta dim">    
                                    <i class="fa fa-info-circle"></i> Posted {{e.published_on|datetime }} {%if e.author %} by {{ e.author }}{% endif %}                                              
                                </div>
                            </article>    
                        </div>
                    </div>
                </div>                                      
            </template>
        </li>
        {% set ns.prev_date = date  %}
    {% else %}
        <div class="notice">
            <i class="fa fa-tint fa-4x"></i>
            No entries found.
        </div>    
    {% endfor %}
    {% if offset < count %}
        <li class="more">
            {% set request_url = url_for('main.entry_list', filter=filter_name, offset=offset, prev_date=prev_date, xhr=1) %}
            <button class="btn-text" onclick="Sweat.loadMore('{{request_url}}')">More</button>
        </li>
    {% endif %}
    <script id="popover-content" type="text/html">
        <a class="btn btn-small btn-default" href="{{ url_for('main.entry_list_mark', feed=feed_id ) }}" data-remote-modal>Mark as Read</a>
        <a class="btn btn-small btn-default" href="{{ url_for('main.feed_edit', feed=feed_id ) }}" data-remote-modal="modal-feed-edit">About</a>
        <a class="btn btn-small btn-error" href="{{ url_for('main.feed_remove', feed=feed_id ) }}" data-remote-modal>Remove</a>
    </script>    
{% endmacro %}

{% if is_xhr %}
    {{render_entries()}}
{% else %}
    {% extends "main/index.html" %}
    {% block panel_block %}
        {% if count %}
            <div class="panel-content">
                <ul id="entry-list" class="view list-view">                      
                    {{render_entries()}}
                </ul>
                <div class="entry__filter">

                    {% if count and (filter_class in ['unread']) %}
                        <a title="Mark all as read" data-toggle="tooltip" data-placement="bottom" href="{{ url_for('main.entry_list_mark', all='') }}" data-remote-modal><i class="fa fa-check-square"></i></a>
                    {% elif count and feed_id and filter_class in ['feeds'] %}
                        <a class="popover-trigger" data-container="body" href="#popover-content"><i class="fa fa-cog"></i> Manage</a>
                    {% endif %}  

                    <div class="radio-switch">
                        <label class="radio-switch__label">
                            {% set request_url_1 = url_for('main.entry_list', filter='unread', xhr=1) %}
                            <input type="radio" name="status" onchange="Sweat.loadFolder('{{request_url_1}}')" checked value="unread" class="radio-switch__input" /><i class="fa fa-circle"></i>
                        </label>
                        <label class="radio-switch__label">
                            {% set request_url_2 = url_for('main.entry_list', filter='saved', xhr=1) %}
                            <input type="radio" name="status" onchange="Sweat.loadFolder('{{request_url_2}}')" value="saved" class="radio-switch__input" /><i class="fa fa-star"></i>
                        </label>
                        <label class="radio-switch__label">
                            {% set request_url_3 = url_for('main.entry_list', filter='all', xhr=1) %}
                            <input type="radio" name="status" onchange="Sweat.loadFolder('{{request_url_3}}')" value="all" class="radio-switch__input" /><i class="fa fa-archive"></i>
                        </label>
                    </div>

                    <div>
                        {% if feed_id and filter_class in ['feeds'] %}
                            {% set feed_edit_url = url_for('main.feed_edit', feed=feed_id ) %}
                            <button class="btn-text" onclick="Sweat.openRemoteModal('{{feed_edit_url}}', event)" data-remote-modal="modal-feed-edit">
                                <i class="fa fa-cog"></i>
                            </button>
                        {% elif filter_class in ['groups'] %}
                            <button onclick="" class="btn-text" data-remote-modal="modal-group-edit">
                                <i class="fa fa-cog"></i>
                            </button>
                        {% endif %}   
                    </div>
                </div>
            </div>
        {% else %}
            <div class="notice">
                <i class="fa fa-tint fa-4x"></i>
                No entries found.
            </div>
        {% endif %}
    {% endblock %}
{% endif %}